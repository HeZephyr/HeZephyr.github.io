<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识 | ZephyrHe</title><meta name=author content="HeZephyr">
<meta name=author-link content="https://github.com/HeZephyr"><meta name=description content="翻译原文地址
1 CPU知识为何不再足够
  
    
  
在当今的人工智能时代，大多数开发者都是按照CPU的方式进行训练。这种认知也已经成为我们学术中的一部分，因此很自然地会以CPU为导向来思考和解决问题。"><meta name=keywords content='GPU'><meta itemprop=name content="AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识"><meta itemprop=description content="翻译原文地址
1 CPU知识为何不再足够 在当今的人工智能时代，大多数开发者都是按照CPU的方式进行训练。这种认知也已经成为我们学术中的一部分，因此很自然地会以CPU为导向来思考和解决问题。"><meta itemprop=datePublished content="2024-05-12T00:00:00+00:00"><meta itemprop=dateModified content="2024-10-15T13:58:47+00:00"><meta itemprop=wordCount content="4852"><meta itemprop=image content="https://hezephyr.github.io/images/apple-devices-preview.webp"><meta itemprop=keywords content="GPU"><meta property="og:url" content="https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"><meta property="og:site_name" content="ZephyrHe"><meta property="og:title" content="AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识"><meta property="og:description" content="翻译原文地址
1 CPU知识为何不再足够 在当今的人工智能时代，大多数开发者都是按照CPU的方式进行训练。这种认知也已经成为我们学术中的一部分，因此很自然地会以CPU为导向来思考和解决问题。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-15T13:58:47+00:00"><meta property="article:tag" content="GPU"><meta property="og:image" content="https://hezephyr.github.io/images/apple-devices-preview.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hezephyr.github.io/images/apple-devices-preview.webp"><meta name=twitter:title content="AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识"><meta name=twitter:description content="翻译原文地址
1 CPU知识为何不再足够 在当今的人工智能时代，大多数开发者都是按照CPU的方式进行训练。这种认知也已经成为我们学术中的一部分，因此很自然地会以CPU为导向来思考和解决问题。"><meta name=application-name content="Zephyr's Blog"><meta name=apple-mobile-web-app-title content="Zephyr's Blog"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/><link rel=prev href=https://hezephyr.github.io/posts/01.%E8%AF%BE%E7%A8%8B%E7%BD%91%E7%AB%99/><link rel=next href=https://hezephyr.github.io/posts/02.%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0gfs/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/hezephyr.github.io\/posts\/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86\/"},"image":[{"@type":"ImageObject","url":"https:\/\/hezephyr.github.io\/images\/apple-devices-preview.webp","width":2880,"height":1508}],"genre":"posts","keywords":"GPU","wordcount":4852,"url":"https:\/\/hezephyr.github.io\/posts\/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86\/","datePublished":"2024-05-12T00:00:00+00:00","dateModified":"2024-10-15T13:58:47+00:00","license":"本站内容采用 CC BY-NC-SA 4.0 国际许可协议。","publisher":{"@type":"Organization","name":"Lruihao","logo":"https:\/\/hezephyr.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"HeZephyr"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=ZephyrHe><img loading=lazy src=/images/logo.png alt=ZephyrHe data-title=ZephyrHe width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>HeZephyr</span></a><span class=header-subtitle>贺志飞的博客</span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=ZephyrHe><img loading=lazy src=/images/logo.png alt=ZephyrHe data-title=ZephyrHe width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>HeZephyr</span></a><span class=header-subtitle>贺志飞的博客</span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/guestbook/><i class="fa-solid fa-comments fa-fw fa-sm" aria-hidden=true></i> 留言</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item text-center"><a class=menu-link href=https://github.com/HeZephyr/HeZephyr.github.io title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/posts/ title=Posts>文章</a></li><li class="breadcrumb-item active" aria-current=page>AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识</li></ol></nav><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name data-collections=合集>知识科普</span>
<span class=collection-count>1</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><span class=active title=AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识>AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识</span></li></ul><div class=collection-nav-simple><i class="fa-solid fa-angle-left fa-fw collection-nav-item text-secondary" aria-hidden=true></i><span class=text-secondary>1/1</span><i class="fa-solid fa-angle-right fa-fw collection-nav-item text-secondary" aria-hidden=true></i></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/HeZephyr title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src="https://cn.gravatar.com/avatar/65f6ab71abcb9d540eb32a2704884927?s=32&amp;d=mp" alt=HeZephyr data-title=HeZephyr width=20 height=20 class=avatar style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;HeZephyr</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/%E7%9F%A5%E8%AF%86%E7%A7%91%E6%99%AE/ class=post-category title="分类 - 知识科普"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 知识科普</a> 和 <a href=/collections/%E7%9F%A5%E8%AF%86%E7%A7%91%E6%99%AE/ class=post-collection title="合集 - 知识科普"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> 知识科普</a></span></div><div class=post-meta-line><span title="发布于 2024-05-12 00:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-05-12>2024-05-12</time></span>&nbsp;<span title="更新于 2024-10-15 13:58:47"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-10-15>2024-10-15</time></span>&nbsp;<span title="4852 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4900 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 10 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识>
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#cpu知识为何不再足够>CPU知识为何不再足够</a></li><li><a href=#gpu驱动开发如何解决这些问题>GPU驱动开发如何解决这些问题</a></li><li><a href=#gpu和cpu有什么区别>GPU和CPU有什么区别</a></li><li><a href=#gpu类型>GPU类型</a></li><li><a href=#使用-nvidia-的-cuda-进行-gpu-驱动开发>使用 Nvidia 的 CUDA 进行 GPU 驱动开发</a><ol><li><a href=#linux安装cuda>Linux安装CUDA</a></li><li><a href=#基本命令>基本命令</a></li><li><a href=#开始使用cuda框架>开始使用CUDA框架</a><ol><li><a href=#数组加法问题>数组加法问题</a></li><li><a href=#使用-gpu-在-python-中优化图像生成>使用 GPU 在 Python 中优化图像生成</a></li><li><a href=#使用-gpu-训练猫狗神经网络>使用 GPU 训练猫狗神经网络</a></li></ol></li></ol></li><li><a href=#结论>结论</a></li></ol></nav></div></div><div class=content id=content data-end-flag="「本文完，更多内容汇总在我的 GitHub与CSDN，持续更新，求关注、求 star、求订阅！」"><p><a href=https://journal.hexmos.com/gpu-survival-toolkit/ target=_blank rel="external nofollow noopener noreferrer">翻译原文地址<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p><h2 id=cpu知识为何不再足够 class=heading-element><span>1 CPU知识为何不再足够</span>
<a href=#cpu%e7%9f%a5%e8%af%86%e4%b8%ba%e4%bd%95%e4%b8%8d%e5%86%8d%e8%b6%b3%e5%a4%9f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在当今的人工智能时代，大多数开发者都是按照CPU的方式进行训练。这种认知也已经成为我们学术中的一部分，因此很自然地会<strong>以CPU为导向</strong>来思考和解决问题。</p><p>然而，CPU 的问题在于它们<strong>依赖于串行架构</strong>。在当今世界中，我们依赖大量并行任务的情况下，CPU 无法很好地处理这些场景。</p><p>因此，开发者面临着如下问题。</p><ul><li><p><strong>执行并行任务</strong></p><blockquote><p>CPU 传统上是线性运行的，一次执行一条指令。这种限制源于这样一个事实：CPU 通常具有一些针对单线程性能进行优化的强大内核。当面临多个任务时，CPU会分配其资源来逐个处理每个任务，从而导致指令的顺序执行。在需要同时关注众多任务的情况下，这种方法变得低效。</p><p>尽管我们通过诸如多线程等技术来提高CPU性能，但CPU的基本设计理念是优先考虑顺序执行。</p></blockquote></li><li><p><strong>高效运行AI模型</strong></p><blockquote><p>AI 模型采用 Transformer 等先进架构，利用并行处理来增强性能。与顺序运行的<strong>旧递归神经网络 (RNN)</strong> 不同，<strong>GPT 等现代 Transformer</strong> 可以同时处理多个单词，从而提高训练效率和能力。因为当我们并行训练时，会产生更大的模型，而更大的模型会产生更好的输出。</p><p>并行的概念已从自然语言处理扩展到<strong>图像识别</strong>等其他领域。例如，图像识别架构 AlexNet 通过同时处理图像的不同部分，展示了并行处理的威力，从而实现准确的模式识别。</p><p>然而，CPU 的设计侧重于单线程性能，很难充分挖掘并行处理的潜力。它们难以有效分配和执行复杂AI模型所需的大量并行计算。</p></blockquote></li></ul><h2 id=gpu驱动开发如何解决这些问题 class=heading-element><span>2 GPU驱动开发如何解决这些问题</span>
<a href=#gpu%e9%a9%b1%e5%8a%a8%e5%bc%80%e5%8f%91%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e8%bf%99%e4%ba%9b%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><p><strong>GPU 核心的大规模并行性</strong></p><blockquote><p>与 CPU 中<strong>更大、更强大的内核</strong>相比，工程师设计的 GPU 具有<strong>更小、高度专业化的内核</strong>。该架构允许 GPU 同时执行多个并行任务。</p><p>GPU 中的大量核心非常适合依赖于并行性的工作负载，例如图形渲染和复杂的数学计算。</p><p>如下图所示，5.3.2使用 GPU 并行性来减少复杂任务所需的时间。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png?size=small" data-sub-html="<h2>GPUDemo1</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png alt=GPUDemo1 srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/55f060b6b97ac9b7c285a8732c69829e12e3211339b992c18ec49716a6fac938.png?size=large 2x" data-title=GPUDemo1 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li><li><p><strong>AI 模型中使用的并行性</strong></p><blockquote><p>人工智能模型，特别是基于 <a href="https://www.tensorflow.org/?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">TensorFlow<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 等深度学习框架构建的模型，表现出高度的并行性。神经网络训练涉及大量矩阵运算，而 GPU 凭借其庞大的核心数量，擅长并行化这些运算。 TensorFlow 与其他流行的深度学习框架一起进行优化，以利用 GPU 的能力来加速模型训练和推理。</p><p>如下图所示，5.3.3使用 GPU 的强大功能来训练神经网络。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png?size=small" data-sub-html="<h2>GPUDemo1</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png alt=GPUDemo1 srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/5078635f14fc266b48058cafe1f214608eecd89f0ddfebfc481df24704a7bba9.png?size=large 2x" data-title=GPUDemo1 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li></ul><h2 id=gpu和cpu有什么区别 class=heading-element><span>3 GPU和CPU有什么区别</span>
<a href=#gpu%e5%92%8ccpu%e6%9c%89%e4%bb%80%e4%b9%88%e5%8c%ba%e5%88%ab class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><p><strong>CPU</strong></p><ul><li><p><strong>串行架构</strong></p><blockquote><p>中央处理单元 (CPU) 的设计重点是顺序处理。它们擅长线性执行一组指令。CPU 针对需要高单线程性能的任务进行了优化，例如：</p><ul><li><strong>通用计算</strong></li><li><strong>系统操作</strong></li><li><strong>处理涉及条件分支的复杂算法</strong></li></ul></blockquote></li><li><p><strong>并行任务的核心数量有限</strong></p><blockquote><p>CPU 的核心数量较少，在消费级处理器中通常为 <strong>2-16</strong> 个核心。每个内核都能够独立处理自己的指令集。</p></blockquote></li></ul></li><li><p><strong>GPU</strong></p><ul><li><p><strong>并行架构</strong></p><blockquote><p>图形处理单元（GPU）采用并行架构设计，使其能够高效地执行并行处理任务。这有利于：</p><ul><li><strong>渲染图形</strong></li><li><strong>执行复杂的数学计算</strong></li><li><strong>运行可并行算法</strong></li></ul><p>GPU 通过将多个任务分解为更小的并行子任务来同时处理多个任务。</p></blockquote></li><li><p><strong>数千个内核用于并行任务</strong></p><blockquote><p>与 CPU 不同，GPU 拥有更多的核心，通常有数千个。这些内核被组织成流式多处理器 (SM) 或类似的结构。丰富的内核使 GPU 能够同时处理大量数据，非常适合并行任务，例如图像和视频处理、深度学习和科学模拟。</p></blockquote></li></ul></li></ul><h2 id=gpu类型 class=heading-element><span>4 GPU类型</span>
<a href=#gpu%e7%b1%bb%e5%9e%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><p><strong>通用 Gpu</strong></p><blockquote><p>通用 GPU 实例（P3 和 P4 实例）适用于广泛的工作负载，包括机器学习训练和推理、图像处理和视频编码。它们的平衡性能使它们成为各种计算任务的理想选择。</p></blockquote></li><li><p><strong>推理优化的 GPU</strong></p><blockquote><p>推理是运行已经训练好的 AI 模型并对实时数据进行预测或任务求解的过程。推理优化的 GPU 实例（P5 和 Inf1 实例）在低延迟和成本效率至关重要的情况下表现出色，特别适用于机器学习推理任务。</p></blockquote></li><li><p><strong>图形优化的 GPU</strong></p><blockquote><p>图形优化的 GPU 实例（G4 实例）专门设计用于处理图形密集型任务，如视频游戏开发中的 3D 图形渲染。这些实例非常适合需要处理大量图形数据的应用程序。</p></blockquote></li><li><p><strong>托管 GPU</strong></p><blockquote><p>Amazon SageMaker 是一种托管服务，为机器学习提供了易于使用的 GPU 实例。它提供对多种 GPU 实例（包括 P3、P4 和 P5 实例）的访问，适用于想要轻松开始机器学习而无需管理底层基础设施的组织。</p></blockquote></li></ul><h2 id=使用-nvidia-的-cuda-进行-gpu-驱动开发 class=heading-element><span>5 使用 Nvidia 的 CUDA 进行 GPU 驱动开发</span>
<a href=#%e4%bd%bf%e7%94%a8-nvidia-%e7%9a%84-cuda-%e8%bf%9b%e8%a1%8c-gpu-%e9%a9%b1%e5%8a%a8%e5%bc%80%e5%8f%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>CUDA 是 NVIDIA 开发的并行计算平台和编程模型，使开发人员能够利用 GPU 加速器的强大功能来加速其应用程序。</p><h3 id=linux安装cuda class=heading-element><span>5.1 Linux安装CUDA</span>
<a href=#linux%e5%ae%89%e8%a3%85cuda class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><p>下载<a href="https://developer.nvidia.com/cuda-downloads?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">CUDA<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p></li><li><p>从上面的链接下载基本安装程序以及驱动程序安装程序</p></li><li><p>转到主文件夹中的 <code>.bashrc</code>（如果使用其他shell则使用对应的配置文件）</p></li><li><p>在配置文件中添加以下行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>PATH</span><span class=o>=</span><span class=s2>&#34;/usr/local/cuda-12.3/bin:$PATH&#34;</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>LD_LIBRARY_PATH</span><span class=o>=</span><span class=s2>&#34;/usr/local/cuda-12.3/lib64:$LD_LIBRARY_PATH&#34;</span></span></span></code></pre></td></tr></table></div></div></li><li><p>然后执行以下命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>sudo</span> <span class=n>apt</span><span class=o>-</span><span class=n>get</span> <span class=n>install</span> <span class=n>cuda</span><span class=o>-</span><span class=n>toolkit</span>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=n>apt</span><span class=o>-</span><span class=n>get</span> <span class=n>install</span> <span class=n>nvidia</span><span class=o>-</span><span class=n>gds</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=基本命令 class=heading-element><span>5.2 基本命令</span>
<a href=#%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><p><code>lspci | grep VGA</code></p><blockquote><p>识别并列出系统中的 GPU。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/ea108a4de53720d8e4de22247f92b43481a000cfe41026826e52f4af020b9c0f-20240319153537737.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li><li><p><code>nvidia-smi</code></p><blockquote><p>“NVIDIA 系统管理界面”，它提供有关系统中 NVIDIA GPU 的详细信息，包括利用率、温度、内存使用情况等。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/b467adbefdfe4fced1552ca63134994c2924dc648955adb585c80d1a6356f10f.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li><li><p><code>sudo lshw -C display</code></p><blockquote><p>提供有关系统中显示控制器（包括显卡）的详细信息。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/0af5ca02e576f5da48a561ebffb4bd20e4051899cb1b1e69caca78aeff58cff7.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li><li><p><code>inxi -G</code></p><blockquote><p>提供有关图形子系统的信息，包括有关 GPU 和显示器的详细信息。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/8352bf05d3be3b8085e837de0f69f244ab6c34041c6b462cf78513fcae6373c0.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li><li><p><code>sudo hwinfo --gfxcard</code></p><blockquote><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/70fa1b931593c213a1a949dbc700d47cca2e933cee331d63e03e0806d6327baa.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></blockquote></li></ul><h3 id=开始使用cuda框架 class=heading-element><span>5.3 开始使用CUDA框架</span>
<a href=#%e5%bc%80%e5%a7%8b%e4%bd%bf%e7%94%a8cuda%e6%a1%86%e6%9e%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>当我们安装了 CUDA 框架后，让我们开始执行展示其功能的操作。</p><h4 id=数组加法问题 class=heading-element><span>5.3.1 数组加法问题</span>
<a href=#%e6%95%b0%e7%bb%84%e5%8a%a0%e6%b3%95%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>数组加法问题是演示 GPU 并行化的一个合适问题。考虑以下数组：</p><ul><li><p>数组 $A = [1,2,3,4,5,6]$</p></li><li><p>数组 $B = [7,8,9,10,11,12]$</p></li><li><p>我们需要存储每个元素的和并将其存储在数组$C$中。我们需要存储每个元素的和并将其存储在数组$C$中。</p></li><li><p>就像 $C = [1+7,2+8,3+9,4+10,5+11,6+12] = [8,10,12,14,16,18]$</p></li><li><p>如果CPU要执行这样的操作，它将执行如下代码所示的操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>a</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>b</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>c</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>N</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>  <span class=c1>// Number of elements
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;c[%d] = %d&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></li></ul><p>这种方法是逐个遍历数组元素并依次执行加法。然而，当处理大量数字时，这种方法由于其顺序性质而变得缓慢。</p><p>为了解决这个限制，GPU 通过并行化加法过程提供了一种解决方案。与依次执行运算的 CPU 不同，GPU 可以同时执行多项加法。例如，运算$1+7、2+8、3+9、4+10、5+11$和$6+12$可以借助GPU并行化同时执行。</p><p>利用CUDA，我们将使用内核文件 (.cu) 进行展示。实现并行加法的代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>__global__</span> <span class=kt>void</span> <span class=nf>vectorAdd</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span><span class=o>*</span> <span class=n>b</span><span class=p>,</span> <span class=kt>int</span><span class=o>*</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>threadIdx</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>__global__</code> 说明符表明该函数是一个内核函数，将在 GPU 上调用。</li><li><code>vectorAdd</code> 采用三个整数指针（$a$、$b$ 和 $c$）作为参数，表示要相加的向量。</li><li><code>threadIdx.x</code> 检索当前线程的索引（在一维网格中）。</li><li>向量 $a$ 和 $b$ 的相应元素之和存储在向量 $c$ 中。</li></ul><p>现在我们来看看主要功能。创建指针 <code>cudaA</code> 、 <code>cudaB</code> 和 <code>cudaC</code> 来指向 GPU 上的内存。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// 利用 CUDA 使用并行计算加法的函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>b</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>[</span><span class=k>sizeof</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>/</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>)]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建指向 GPU 的指针
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span><span class=o>*</span> <span class=n>cudaA</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span><span class=o>*</span> <span class=n>cudaB</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span><span class=o>*</span> <span class=n>cudaC</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>使用 <code>cudaMalloc</code> ，在 GPU 上为向量 <code>cudaA</code>、<code>cudaB</code> 和 <code>cudaC</code> 分配内存。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// 在GPU中分配内存
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>cudaMalloc</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cudaA</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>a</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nf>cudaMalloc</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cudaB</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>b</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nf>cudaMalloc</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cudaC</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>c</span><span class=p>));</span></span></span></code></pre></td></tr></table></div></div><p>内核函数 <code>vectorAdd</code> 使用一个块和等于向量大小的多个线程启动。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// 用一个程序块和与向量大小相等的线程数启动内核
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>vectorAdd</span> <span class=o>&lt;&lt;&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>/</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>&gt;&gt;&gt;</span> <span class=p>(</span><span class=n>cudaA</span><span class=p>,</span> <span class=n>cudaB</span><span class=p>,</span> <span class=n>cudaC</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>结果向量 <code>cudaC</code> 从GPU复制回主机。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// 将结果向量复制回主机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>cudaMemcpy</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>cudaC</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>c</span><span class=p>),</span> <span class=n>cudaMemcpyDeviceToHost</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>然后我们可以照常打印结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>    <span class=c1>// 打印结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>/</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;c[%d] = %d&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>为了执行此代码，我们将使用 <code>nvcc</code> 命令。我们将得到输出为：</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png?size=small" data-sub-html="<h2>GPU Output</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png alt="GPU Output" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/144c2193b0d5ad71eb7bd4da490534fb278ed174df6ec8c6411b039f16757116.png?size=large 2x" data-title="GPU Output" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p><p>这是<a href="https://github.com/RijulTP/GPUToolkit/tree/main/array-addition?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">完整的代码<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>供读者参考。</p><h4 id=使用-gpu-在-python-中优化图像生成 class=heading-element><span>5.3.2 使用 GPU 在 Python 中优化图像生成</span>
<a href=#%e4%bd%bf%e7%94%a8-gpu-%e5%9c%a8-python-%e4%b8%ad%e4%bc%98%e5%8c%96%e5%9b%be%e5%83%8f%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>本节探讨使用 GPU 处理来优化性能密集型任务，例如图像生成。</p><p><strong>Mandelbrot 集</strong>是一种数学构造，它根据规定方程中特定数字的行为形成复杂的视觉模式。生成一个这样的图案需要耗费大量资源。在下面的代码片段中，您可以观察到使用 CPU 处理生成 Mandelbrot 集的传统方法，该方法速度很慢。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># 导入必要的库</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>matplotlib</span> <span class=kn>import</span> <span class=n>pyplot</span> <span class=k>as</span> <span class=n>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pylab</span> <span class=kn>import</span> <span class=n>imshow</span><span class=p>,</span> <span class=n>show</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>timeit</span> <span class=kn>import</span> <span class=n>default_timer</span> <span class=k>as</span> <span class=n>timer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算给定点 (x, y) 的 Mandelbrot 集的函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mandel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>max_iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>complex</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>z</span> <span class=o>=</span> <span class=mf>0.0</span><span class=n>j</span>
</span></span><span class=line><span class=cl>    <span class=c1># 迭代检查该点是否在 Mandelbrot 集中</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>z</span> <span class=o>=</span> <span class=n>z</span><span class=o>*</span><span class=n>z</span> <span class=o>+</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>z</span><span class=o>.</span><span class=n>real</span><span class=o>*</span><span class=n>z</span><span class=o>.</span><span class=n>real</span> <span class=o>+</span> <span class=n>z</span><span class=o>.</span><span class=n>imag</span><span class=o>*</span><span class=n>z</span><span class=o>.</span><span class=n>imag</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=c1># 如果在最大迭代次数内，则将其视为集合的一部分</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>max_iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在指定区域内创建 Mandelbrot 分形的函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_fractal</span><span class=p>(</span><span class=n>min_x</span><span class=p>,</span> <span class=n>max_x</span><span class=p>,</span> <span class=n>min_y</span><span class=p>,</span> <span class=n>max_y</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>height</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>width</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 根据指定区域计算像素大小</span>
</span></span><span class=line><span class=cl>    <span class=n>pixel_size_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>max_x</span> <span class=o>-</span> <span class=n>min_x</span><span class=p>)</span> <span class=o>/</span> <span class=n>width</span>
</span></span><span class=line><span class=cl>    <span class=n>pixel_size_y</span> <span class=o>=</span> <span class=p>(</span><span class=n>max_y</span> <span class=o>-</span> <span class=n>min_y</span><span class=p>)</span> <span class=o>/</span> <span class=n>height</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 在图像中迭代每个像素并计算Mandelbrot值</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>width</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>real</span> <span class=o>=</span> <span class=n>min_x</span> <span class=o>+</span> <span class=n>x</span> <span class=o>*</span> <span class=n>pixel_size_x</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>height</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>imag</span> <span class=o>=</span> <span class=n>min_y</span> <span class=o>+</span> <span class=n>y</span> <span class=o>*</span> <span class=n>pixel_size_y</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>mandel</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span><span class=p>,</span> <span class=n>iters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>image</span><span class=p>[</span><span class=n>y</span><span class=p>,</span> <span class=n>x</span><span class=p>]</span> <span class=o>=</span> <span class=n>color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 为 Mandelbrot 集创建一个空白图像数组</span>
</span></span><span class=line><span class=cl><span class=n>image</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>1024</span><span class=p>,</span> <span class=mi>1536</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 记录性能测量的开始时间</span>
</span></span><span class=line><span class=cl><span class=n>start</span> <span class=o>=</span> <span class=n>timer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在指定的区域和迭代次数内生成Mandelbrot集合</span>
</span></span><span class=line><span class=cl><span class=n>create_fractal</span><span class=p>(</span><span class=o>-</span><span class=mf>2.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算创建 Mandelbrot 集所需的时间</span>
</span></span><span class=line><span class=cl><span class=n>dt</span> <span class=o>=</span> <span class=n>timer</span><span class=p>()</span> <span class=o>-</span> <span class=n>start</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打印生成 Mandelbrot 集所需的时间</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Mandelbrot created in </span><span class=si>%f</span><span class=s2> s&#34;</span> <span class=o>%</span> <span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 matplotlib 显示 Mandelbrot 集</span>
</span></span><span class=line><span class=cl><span class=n>imshow</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>上面的代码在 <code>4.07</code> 秒内生成输出。<a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png?size=small" data-sub-html="<h2>Mandelbrot without GPU</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png alt="Mandelbrot without GPU" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/14af8fd709215ad96688a3364deefea9cfc2fa13497810587106cef04c5a413c.png?size=large 2x" data-title="Mandelbrot without GPU" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p><p>为了加快速度，我们可以使用 <a href="https://numba.pydata.org/?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">Numba<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 库将代码与 GPU 并行化，具体操作如下：</p><ul><li><p>我们将从 numba 导入即时编译、用于 GPU 加速的 CUDA 以及其他工具库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>numba</span> <span class=kn>import</span> <span class=n>jit</span><span class=p>,</span> <span class=n>cuda</span><span class=p>,</span> <span class=n>uint32</span><span class=p>,</span> <span class=n>f8</span><span class=p>,</span> <span class=n>uint8</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pylab</span> <span class=kn>import</span> <span class=n>imshow</span><span class=p>,</span> <span class=n>show</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>timeit</span> <span class=kn>import</span> <span class=n>default_timer</span> <span class=k>as</span> <span class=n>timer</span></span></span></code></pre></td></tr></table></div></div></li><li><p><code>@jit</code> 装饰器指示 Numba 执行即时编译，将 Python 代码转换为机器代码以提高执行速度。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@jit</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mandel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>max_iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nb>complex</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>z</span> <span class=o>=</span> <span class=mf>0.0</span><span class=n>j</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>z</span> <span class=o>=</span> <span class=n>z</span><span class=o>*</span><span class=n>z</span> <span class=o>+</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>z</span><span class=o>.</span><span class=n>real</span><span class=o>*</span><span class=n>z</span><span class=o>.</span><span class=n>real</span> <span class=o>+</span> <span class=n>z</span><span class=o>.</span><span class=n>imag</span><span class=o>*</span><span class=n>z</span><span class=o>.</span><span class=n>imag</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>max_iters</span></span></span></code></pre></td></tr></table></div></div></li><li><p><code>mandel_gpu</code> 是使用 <code>cuda.jit</code> 创建的 mandel 函数的 GPU 兼容版本。这允许将 mandel 逻辑卸载到 GPU。这是通过使用 <code>@cuda.jit</code> 装饰器并指定函数参数的数据类型（<code>f8</code> 表示浮点数，``uint32<code> 表示无符号32位整数）来完成的。</code>device=True` 参数指示该函数将在 GPU 上运行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mandel_gpu</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>jit</span><span class=p>((</span><span class=n>f8</span><span class=p>,</span> <span class=n>f8</span><span class=p>,</span> <span class=n>uint32</span><span class=p>),</span> <span class=n>device</span><span class=o>=</span><span class=kc>True</span><span class=p>)(</span><span class=n>mandel</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></li><li><p><code>mandel_kernel</code> 函数被定义为在 CUDA GPU 上执行。它负责跨 GPU 线程并行生成 Mandelbrot 集。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@cuda.jit</span><span class=p>((</span><span class=n>f8</span><span class=p>,</span> <span class=n>f8</span><span class=p>,</span> <span class=n>f8</span><span class=p>,</span> <span class=n>f8</span><span class=p>,</span> <span class=n>uint8</span><span class=p>[:,:],</span> <span class=n>uint32</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mandel_kernel</span><span class=p>(</span><span class=n>min_x</span><span class=p>,</span> <span class=n>max_x</span><span class=p>,</span> <span class=n>min_y</span><span class=p>,</span> <span class=n>max_y</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>height</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>width</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pixel_size_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>max_x</span> <span class=o>-</span> <span class=n>min_x</span><span class=p>)</span> <span class=o>/</span> <span class=n>width</span>
</span></span><span class=line><span class=cl>    <span class=n>pixel_size_y</span> <span class=o>=</span> <span class=p>(</span><span class=n>max_y</span> <span class=o>-</span> <span class=n>min_y</span><span class=p>)</span> <span class=o>/</span> <span class=n>height</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>startX</span><span class=p>,</span> <span class=n>startY</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>gridX</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>gridDim</span><span class=o>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>cuda</span><span class=o>.</span><span class=n>blockDim</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl>    <span class=n>gridY</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>gridDim</span><span class=o>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>cuda</span><span class=o>.</span><span class=n>blockDim</span><span class=o>.</span><span class=n>y</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>startX</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>gridX</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>real</span> <span class=o>=</span> <span class=n>min_x</span> <span class=o>+</span> <span class=n>x</span> <span class=o>*</span> <span class=n>pixel_size_x</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>startY</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=n>gridY</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>imag</span> <span class=o>=</span> <span class=n>min_y</span> <span class=o>+</span> <span class=n>y</span> <span class=o>*</span> <span class=n>pixel_size_y</span>
</span></span><span class=line><span class=cl>            <span class=n>image</span><span class=p>[</span><span class=n>y</span><span class=p>,</span> <span class=n>x</span><span class=p>]</span> <span class=o>=</span> <span class=n>mandel_gpu</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span><span class=p>,</span> <span class=n>iters</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></li><li><p>现在，我们可以在 <code>create_fractal_gpu</code> 函数中使用 GPU 加速的 Mandelbrot 集生成。该函数分配 GPU 内存，启动 GPU 内核 (mandel_kernel)，并将结果复制回 CPU。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_fractal_gpu</span><span class=p>(</span><span class=n>min_x</span><span class=p>,</span> <span class=n>max_x</span><span class=p>,</span> <span class=n>min_y</span><span class=p>,</span> <span class=n>max_y</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Step 1: 为图像分配GPU内存</span>
</span></span><span class=line><span class=cl>    <span class=n>d_image</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>to_device</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 2: 定义GPU并行化的线程和块数</span>
</span></span><span class=line><span class=cl>    <span class=n>threadsperblock</span> <span class=o>=</span> <span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>blockspergrid_x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>/</span> <span class=n>threadsperblock</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>blockspergrid_y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>/</span> <span class=n>threadsperblock</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>blockspergrid</span> <span class=o>=</span> <span class=p>(</span><span class=n>blockspergrid_x</span><span class=p>,</span> <span class=n>blockspergrid_y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 3: 测量开始时间</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=n>timer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 4: 启动 GPU 内核（mandel_kernel）在 GPU 上计算 Mandelbrot 集。</span>
</span></span><span class=line><span class=cl>    <span class=n>mandel_kernel</span><span class=p>[</span><span class=n>blockspergrid</span><span class=p>,</span> <span class=n>threadsperblock</span><span class=p>](</span><span class=n>min_x</span><span class=p>,</span> <span class=n>max_x</span><span class=p>,</span> <span class=n>min_y</span><span class=p>,</span> <span class=n>max_y</span><span class=p>,</span> <span class=n>d_image</span><span class=p>,</span> <span class=n>iters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 5: 等待 GPU 完成其工作（同步）</span>
</span></span><span class=line><span class=cl>    <span class=n>cuda</span><span class=o>.</span><span class=n>synchronize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 6: 测量GPU处理所需的时间</span>
</span></span><span class=line><span class=cl>    <span class=n>dt</span> <span class=o>=</span> <span class=n>timer</span><span class=p>()</span> <span class=o>-</span> <span class=n>start</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 7: 将结果从 GPU 内存复制回 CPU</span>
</span></span><span class=line><span class=cl>    <span class=n>d_image</span><span class=o>.</span><span class=n>copy_to_host</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 8: 显示 Mandelbrot 集图像</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Mandelbrot created on GPU in </span><span class=si>%f</span><span class=s2> s&#34;</span> <span class=o>%</span> <span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>imshow</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>show</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div></li></ul><p>上面的代码在 <code>0.0046 seconds</code> 中执行。这比我们之前的基于 CPU 的代码要快得多。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png?size=small" data-sub-html="<h2>Mandelbrot with GPU</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png alt="Mandelbrot with GPU" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/4d62577a332918dc7b5fefc924f27aa6c62599e101e1494184860b82e0e8ddd2.png?size=large 2x" data-title="Mandelbrot with GPU" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p><p>这是<a href="https://github.com/RijulTP/GPUToolkit/tree/main/mandelbrot?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">完整的代码<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>供读者参考。</p><h4 id=使用-gpu-训练猫狗神经网络 class=heading-element><span>5.3.3 使用 GPU 训练猫狗神经网络</span>
<a href=#%e4%bd%bf%e7%94%a8-gpu-%e8%ae%ad%e7%bb%83%e7%8c%ab%e7%8b%97%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>我们现在看到的热门话题之一是 GPU 如何在人工智能中使用，因此为了证明我们将创建一个神经网络来区分猫和狗。我们将使用以下代码训练和使用猫与狗模型，其中使用了卷积神经网络（CNN），您可以阅读有关它的<a href="https://www.analyticsvidhya.com/blog/2021/06/beginner-friendly-project-cat-and-dog-classification-using-cnn/?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">更多详细信息<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p><ul><li><p><strong>先决条件</strong></p><ol><li><p>CUDA</p></li><li><p>Tensorflow -> 可以通过 <code>pip install tensorflow[and-cuda]</code> 安装</p></li><li><p>我们将使用来自<a href="https://www.kaggle.com/competitions/dogs-vs-cats/overview?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">kaggle<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>的猫和狗的数据集</p></li><li><p>下载完成后，解压，将训练文件夹中的猫和狗的图片整理到不同的子文件夹中，如下图所示。</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png?size=small" data-sub-html="<h2>CNN File Structure</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png alt="CNN File Structure" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/47b0cc05fa99283bd8dcd39a801809bdf5521a285df558c1436460ddf4d1ebdd.png?size=large 2x" data-title="CNN File Structure" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p></li></ol></li><li><p><strong>导入库</strong></p><blockquote><ul><li><p><code>pandas</code> 和 <code>numpy</code> 用于数据操作。</p></li><li><p><code>Sequential</code>用于在神经网络中创建线性层堆栈。</p></li><li><p><code>Convolution2D</code>、``MaxPooling2D<code>、</code>Dense<code>和</code>Flatten` 是用于构建卷积神经网络 (CNN) 的层。</p></li><li><p><code>ImageDataGenerator </code>用于在训练期间进行实时数据增强。</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>keras.models</span> <span class=kn>import</span> <span class=n>Sequential</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>keras.layers</span> <span class=kn>import</span> <span class=n>Convolution2D</span><span class=p>,</span> <span class=n>MaxPooling2D</span><span class=p>,</span> <span class=n>Dense</span><span class=p>,</span> <span class=n>Flatten</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>keras.preprocessing.image</span> <span class=kn>import</span> <span class=n>ImageDataGenerator</span></span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><strong>初始化卷积神经网络</strong></p><blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>classifier</span> <span class=o>=</span> <span class=n>Sequential</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><strong>加载训练数据</strong></p><blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>train_datagen</span> <span class=o>=</span> <span class=n>ImageDataGenerator</span><span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=n>rescale</span><span class=o>=</span><span class=mf>1.</span><span class=o>/</span><span class=mi>255</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>shear_range</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>zoom_range</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>horizontal_flip</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>test_datagen</span> <span class=o>=</span> <span class=n>ImageDataGenerator</span><span class=p>(</span><span class=n>rescale</span><span class=o>=</span><span class=mf>1.</span><span class=o>/</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>training_set</span> <span class=o>=</span> <span class=n>train_datagen</span><span class=o>.</span><span class=n>flow_from_directory</span><span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;./training_set&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>target_size</span><span class=o>=</span><span class=p>(</span><span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=n>batch_size</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>class_mode</span><span class=o>=</span><span class=s1>&#39;binary&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>test_set</span> <span class=o>=</span> <span class=n>test_datagen</span><span class=o>.</span><span class=n>flow_from_directory</span><span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;./test_set&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>target_size</span><span class=o>=</span><span class=p>(</span><span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=n>batch_size</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>class_mode</span><span class=o>=</span><span class=s1>&#39;binary&#39;</span></span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><strong>构建 CNN 架构</strong></p><blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>Convolution2D</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>input_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=n>activation</span><span class=o>=</span><span class=s1>&#39;relu&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>MaxPooling2D</span><span class=p>(</span><span class=n>pool_size</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>Flatten</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>Dense</span><span class=p>(</span><span class=n>units</span><span class=o>=</span><span class=mi>128</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s1>&#39;relu&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>Dense</span><span class=p>(</span><span class=n>units</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s1>&#39;sigmoid&#39;</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><strong>编译模型</strong></p><blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>optimizer</span><span class=o>=</span><span class=s1>&#39;adam&#39;</span><span class=p>,</span> <span class=n>loss</span><span class=o>=</span><span class=s1>&#39;binary_crossentropy&#39;</span><span class=p>,</span> <span class=n>metrics</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;accuracy&#39;</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><strong>训练模型</strong></p><blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>training_set</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>25</span><span class=p>,</span> <span class=n>validation_data</span><span class=o>=</span><span class=n>test_set</span><span class=p>,</span> <span class=n>validation_steps</span><span class=o>=</span><span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>classifier</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;trained_model.h5&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></blockquote></li></ul><p>一旦我们训练完模型，模型就会使用 <code>classifier.save</code> 存储在 <code>.h5</code> 文件中。在下面的代码中，我们将使用这个 <code>trained_model.h5</code> 文件来识别猫和狗。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>keras.models</span> <span class=kn>import</span> <span class=n>load_model</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>keras.utils</span> <span class=k>as</span> <span class=nn>image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>predict_image</span><span class=p>(</span><span class=n>imagepath</span><span class=p>,</span> <span class=n>classifier</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>predict</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>load_img</span><span class=p>(</span><span class=n>imagepath</span><span class=p>,</span> <span class=n>target_size</span><span class=o>=</span><span class=p>(</span><span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>predict_modified</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>img_to_array</span><span class=p>(</span><span class=n>predict</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>predict_modified</span> <span class=o>=</span> <span class=n>predict_modified</span> <span class=o>/</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>    <span class=n>predict_modified</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>expand_dims</span><span class=p>(</span><span class=n>predict_modified</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>classifier</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>predict_modified</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>prediction</span> <span class=o>=</span> <span class=s1>&#39;dog&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>probability</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Probability = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>probability</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Prediction = &#34;</span> <span class=o>+</span> <span class=n>prediction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>prediction</span> <span class=o>=</span> <span class=s1>&#39;cat&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>probability</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Probability = &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>probability</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Prediction = &#34;</span> <span class=o>+</span> <span class=n>prediction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 加载训练好的模型</span>
</span></span><span class=line><span class=cl><span class=n>loaded_classifier</span> <span class=o>=</span> <span class=n>load_model</span><span class=p>(</span><span class=s1>&#39;trained_model.h5&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例用法</span>
</span></span><span class=line><span class=cl><span class=n>dog_image</span> <span class=o>=</span> <span class=s2>&#34;dog.jpg&#34;</span>
</span></span><span class=line><span class=cl><span class=n>predict_image</span><span class=p>(</span><span class=n>dog_image</span><span class=p>,</span> <span class=n>loaded_classifier</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cat_image</span> <span class=o>=</span> <span class=s2>&#34;cat.jpg&#34;</span>
</span></span><span class=line><span class=cl><span class=n>predict_image</span><span class=p>(</span><span class=n>cat_image</span><span class=p>,</span> <span class=n>loaded_classifier</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>输出结果如下：</p><p><a class=lightgallery href="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png?size=large" data-thumbnail="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png?size=small" data-sub-html="<h2>Alt text</h2>"><img loading=lazy src=https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png alt="Alt text" srcset="https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png?size=small, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png?size=medium 1.5x, https://raw.githubusercontent.com/unique-pure/NewPicGoLibrary/main/img/d546542af4055bc7163bc49055d5a623a44ad0cc3022d02d0aaa791b9a83d75b.png?size=large 2x" data-title="Alt text" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p><p>这是<a href="https://github.com/RijulTP/GPUToolkit/tree/main/neural-network?ref=journal.hexmos.com" target=_blank rel="external nofollow noopener noreferrer">完整的代码<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>供读者学习参考。</p><h2 id=结论 class=heading-element><span>6 结论</span>
<a href=#%e7%bb%93%e8%ae%ba class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在即将到来的AI时代，GPU是一个不容忽视的东西，我们应该更加了解它的能力。随着我们从传统的串行算法过渡到日益流行的并行算法，GPU 成为加速复杂计算不可或缺的工具。 GPU 的并行处理能力在处理人工智能和机器学习任务固有的海量数据集和复杂的神经网络架构方面特别有优势。此外，GPU 的作用超出了传统的机器学习领域，在科学研究、模拟和数据密集型任务中找到了应用。事实证明，GPU 的并行处理能力有助于解决从药物发现、气候建模到金融模拟等各个领域的挑战。</p></div><hr class=awesome-hr><h2 id=see-also>相关内容</h2><ul><li><a href=/posts/01.%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0mapreduce/ title="【论文阅读笔记】MapReduce: Simplified Data Processing on Large Clusters">【论文阅读笔记】MapReduce: Simplified Data Processing on Large Clusters</a></li><li><a href=/posts/02.%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0gfs/ title="【论文阅读笔记】The Google File System">【论文阅读笔记】The Google File System</a></li><li><a href=/posts/01.%E8%AF%BE%E7%A8%8B%E7%BD%91%E7%AB%99/ title=优秀的CS学习网站>优秀的CS学习网站</a></li><li><a href=/posts/39.andrew%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ title=Andrew文件系统>Andrew文件系统</a></li><li><a href=/posts/38.%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ title=网络文件系统>网络文件系统</a></li></ul><div class=post-reward><div class=comment>Buy me a coffee~</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward><i class="fa-solid fa-qrcode fa-fw" aria-hidden=true></i>赞赏</label><div class=reward-ways data-mode=fixed><div><img loading=lazy src=/images/alipay.png alt="HeZephyr 支付宝" data-title="HeZephyr 支付宝" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span data-animation>支付宝</span></div><div><img loading=lazy src=/images/wechatpay.jpg alt="HeZephyr 微信" data-title="HeZephyr 微信" style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span data-animation>微信</span></div></div></div><div class=collection-card><div class="collection-title text-secondary">收录于 <a href=/collections/%E7%9F%A5%E8%AF%86%E7%A7%91%E6%99%AE/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>合集・知识科普</span></span></a> 1</div><div class=collection-nav></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-10-15 13:58:47">更新于 2024-10-15&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href="https://github.com/HeZephyr/HeZephyr.github.io/blob/docs/content/posts/_knowledge/AI%e6%97%b6%e4%bb%a3%e4%b8%8b%e7%9a%84GPU%e7%94%9f%e5%ad%98%e5%b7%a5%e5%85%b7%e5%8c%85%ef%bc%9a%e6%af%8f%e4%b8%aa%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%bf%85%e9%a1%bb%e4%ba%86%e8%a7%a3%e7%9a%84%e6%9c%80%e5%9f%ba%e6%9c%ac%e7%9f%a5%e8%af%86.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/HeZephyr/HeZephyr.github.io/edit/docs/content/posts/_knowledge/AI%e6%97%b6%e4%bb%a3%e4%b8%8b%e7%9a%84GPU%e7%94%9f%e5%ad%98%e5%b7%a5%e5%85%b7%e5%8c%85%ef%bc%9a%e6%af%8f%e4%b8%aa%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%bf%85%e9%a1%bb%e4%ba%86%e8%a7%a3%e7%9a%84%e6%9c%80%e5%9f%ba%e6%9c%ac%e7%9f%a5%e8%af%86.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/HeZephyr/HeZephyr.github.io/issues/new?title=[BUG]%20AI%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84GPU%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%EF%BC%9A%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cAI%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84GPU%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%EF%BC%9A%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%7c%0A%7cURL%7chttps://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/%7c%0A%7cFilename%7chttps://github.com/HeZephyr/HeZephyr.github.io/blob/docs/content/posts/_knowledge/AI%e6%97%b6%e4%bb%a3%e4%b8%8b%e7%9a%84GPU%e7%94%9f%e5%ad%98%e5%b7%a5%e5%85%b7%e5%8c%85%ef%bc%9a%e6%af%8f%e4%b8%aa%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%bf%85%e9%a1%bb%e4%ba%86%e8%a7%a3%e7%9a%84%e6%9c%80%e5%9f%ba%e6%9c%ac%e7%9f%a5%e8%af%86.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/ data-title=AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识 data-hashtags=GPU><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/ data-hashtag=GPU><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/ data-title=AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://hezephyr.github.io/posts/ai%E6%97%B6%E4%BB%A3%E4%B8%8B%E7%9A%84gpu%E7%94%9F%E5%AD%98%E5%B7%A5%E5%85%B7%E5%8C%85%E6%AF%8F%E4%B8%AA%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%BA%86%E8%A7%A3%E7%9A%84%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/ data-title=AI时代下的GPU生存工具包：每个开发人员必须了解的最基本知识><i data-svg-src=https://unpkg.com/simple-icons@9.19.0/icons/baidu.svg aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/gpu/ class=post-tag title="标签 - GPU">GPU</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/02.%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0gfs/ class=post-nav-item rel=prev title="【论文阅读笔记】The Google File System"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>【论文阅读笔记】The Google File System</a>
<a href=/posts/01.%E8%AF%BE%E7%A8%8B%E7%BD%91%E7%AB%99/ class=post-nav-item rel=next title=优秀的CS学习网站>优秀的CS学习网站<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=HeZephyr/HeZephyr.github.io data-repo-id=R_kgDOMb2HgQ data-category=General data-category-id=DIC_kwDOMb2Hgc4ChPAb data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.135.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.9-RC"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2020 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/HeZephyr target=_blank rel="external nofollow noopener noreferrer">HeZephyr</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">博客已运行</span><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor order-first"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/HeZephyr title="View on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#8581dd;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=https://unpkg.com/lightgallery@2.7.2/css/lightgallery-bundle.min.css><link rel=preload href=https://unpkg.com/katex@0.16.10/dist/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/katex@0.16.10/dist/katex.min.css></noscript><link rel=stylesheet href=https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.css><link rel=stylesheet href=https://unpkg.com/pace-js@1.2.4/themes/blue/pace-theme-minimal.css><script src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://unpkg.com/algoliasearch@4.20.0/dist/algoliasearch-lite.umd.js defer></script><script src=https://unpkg.com/instant.page@5.2.0/instantpage.js async defer type=module></script><script src=https://unpkg.com/lightgallery@2.7.2/lightgallery.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/zoom/lg-zoom.min.js defer></script><script src=https://unpkg.com/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://unpkg.com/katex@0.16.10/dist/katex.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/auto-render.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/copy-tex.min.js defer></script><script src=https://unpkg.com/katex@0.16.10/dist/contrib/mhchem.min.js defer></script><script src=https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.js defer></script><script src=https://unpkg.com/pangu@4.0.7/dist/browser/pangu.min.js defer></script><script src=https://unpkg.com/cell-watermark@1.0.3/src/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=https://unpkg.com/pace-js@1.2.4/pace.min.js async defer></script><script src=/js/flyfish.js defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark_dimmed",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!0,left:"$$",right:"$$"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"},{display:!1,left:"$",right:"$"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"LKM6MKQ6NB",algoliaIndex:"index",algoliaSearchKey:"c9bb91e3a1318f3c9efae98daa87bca5",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2020-06-10T15:42:01+08:00",version:"v0.3.9-RC",watermark:{colspacing:30,content:'<img style="height: 0.85rem;" src="/logo.png" alt="logo" /> 贺志飞',enable:!0,fontfamily:"LiuJianMaoCao-Regular, 钟齐流江毛草",fontsize:1.1,height:20,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>